
@{
    ViewBag.Title = "Discussion";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Instant Help</h2>
<div class="container">
    @if (!User.IsInRole("Staff"))
    {
        <p>Please be aware that this is a chat space for all our customers. You can post your queries here for an instant response from 
    our staff or other users who are currently online, who might be able to help you.</p> 
        <p>If you need to talk directly with our staff, please contact us by email/phone provided @Html.ActionLink("here", "Contact").</p>
    }
    <form onsubmit="return false">
        <div class="form-group">
            <label>Display Name:</label>
            <input type="text" class="form-control" id="displayname" required />
        </div>
        <div class="form-group">
            <label>Message</label>
            <input type="text" class="form-control" id="message" required />
        </div>
        <button type="submit" class="btn btn-primary" id="sendmessage">Post</button>
    </form>
    <h2>Discussion Board</h2>
    <ul id="discussion" class="list-group"></ul>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
 $(function () {
 // Reference the auto-generated proxy for the hub.
 var toDo = $.connection.discussionHub;
 // Create a function that the hub can call back to display messages.
 toDo.client.addNewMessageToPage = function (name, message) {
 // Add the message to the page.
 $('#discussion').append("<li class='list-group-item'><strong>" + htmlEncode(name)
 + '</strong>: ' + htmlEncode(message) + '</li>');
 };
 // Start the connection.
 $.connection.hub.start().done(function () {
 $('#sendmessage').click(function () {
 var displayname = $('#displayname').val();
 var message = $('#message').val();
 if (displayname.length == 0 || message.length == 0)
 return;
 // Call the Send method on the hub.
 toDo.server.send($('#displayname').val(), $('#message').val());
 // Clear text box and reset focus for next comment.
 $('#message').val('');
 });
 });
 });
 // This optional function html-encodes messages for display in the page.
 function htmlEncode(value) {
 var encodedValue = $('<div />').text(value).html();
 return encodedValue;
 }
    </script>
}

